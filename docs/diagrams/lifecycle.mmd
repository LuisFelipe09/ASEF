%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#ffcc00', 'edgeLabelBackground':'#ffffff', 'tertiaryColor': '#fff0f0'}}}%%
graph TD
    subgraph Planning [Planeación y Arquitectura]
        A[Fase A: Destilación] -->|ADR + Gherkin| B(Fase B: Contextualización)
    end

    subgraph Execution [Construcción]
        B -->|Mapas + IaC| C(Fase C: Ejecución / TDD)
    end

    subgraph Audit [Calidad y Seguridad]
        C -->|Código| D{Fase D: Centinela}
        D -- Rechazado (Seguridad/Diseño) --> A
        D -- Rechazado (Bug) --> C
        D -- Aprobado --> E[Fase E: Estabilización]
    end

    E -->|Merge Ready| F((Producción))

    style A fill:#f9f,stroke:#333,stroke-width:2px
    style D fill:#faa,stroke:#f00,stroke-width:2px
